\documentclass{SCreport}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{caption}
\captionsetup{labelsep=period}
\usepackage{float}
\usepackage{hyperref}
\captionsetup{font=small}
% GitHub commands
\newcommand\blob
{https://github.com/PacificCommunity/ofp-sam-transition-plan/blob/main}
\newcommand\present{\blob/presentations}
\newcommand\tree
{https://github.com/PacificCommunity/ofp-sam-transition-plan/tree/main}
% GitHub commands
\newcommand\cpp{\mbox{C\raisebox{0.5ex}{\tiny\bfseries ++}}}
\newcommand\h[1]{\hspace{#1}}
\newcommand\I[1]{\rule{0pt}{#1}}
\reporttype{SC21}
\reportauthor{A.~Magnusson\footnote{\spc}, N.~Davies\footnote{TeTakina Ltd},
  G.~Pilling$^1$, P.~Hamer$^1$}
\reporttitle{Scoping the Next Generation of Tuna Stock Assessment
  Software:\\Progress Report (Project 123)}
\reportnumber{\tpnum/SA-WP-01}
\reportdate{17 July 2025}
\setlength\hyphenpenalty{2000}
\setlength\tolerance{2000}
\hyphenation{implementing}
\begin{document}

\wcpfctitlepage

\tableofcontents
\newpage

\section{Executive summary}

The 3-year Project 123 aims to evaluate features and capabilities that will be
important in future tuna assessments, explore fitting models to tuna data using
existing software platforms, guide decisions on the type of new software
development required, and establish collaboration with tuna Regional Fisheries
Management Organizations (RFMOs) and research labs to achieve these goals.

At SC20, ISG-09 reviewed the scoping of next-generation tuna stock assessment
software and supported prioritizing practical tasks, including transitioning
swordfish and striped marlin assessments to Stock Synthesis and testing
simplified models for yellowfin tuna. Members acknowledged the need to focus on
immediate assessment priorities while keeping longer-term software development
under consideration, depending on available resources and capacity. (SC20
Summary Report, Attachment E).

SC21 will review the progress of Project 123, which explores the transition to
next-generation stock assessment software for tuna fisheries. The project report
i) evaluates the benefits, limitations, uncertainties, and resource implications
associated with each software platform under consideration; ii) evaluates the
feasibility of analyzing tagging data independently from the main stock
assessment models, a potential strategy to reduce model complexity while
maintaining scientific robustness; and iii) identifies key analytical features
and technical capabilities that future stock assessment platforms should
incorporate, such as support for spatial structure, tagging integration, and
flexibility for multi-species and multi-fleet assessments, to ensure that WCPFC
assessments remain scientifically credible, transparent, and adaptable to
evolving fishery and management needs.

SC21 will provide feedback on the progress of the project as needed.

\vspace{4ex}

We invite SC21 to:

\begin{itemize}
  \item note that over the next 5+ years, MULTIFAN-CL will begin to be phased
  out as a software platform for WCPFC tuna and billfish stock assessments;
  \item note that in 2025, the two billfish stock assessments, swordfish and
  striped marlin, transitioned from MULTIFAN-CL to Stock Synthesis;
  \item review and comment on two suggested software development work streams,
  described in this report, providing feedback that will guide the preparation
  of project proposals to be presented to SC22; and
  \item convene an ISWG to discuss the progress and develop activities and a TOR
  for the third year of Project 123.
\end{itemize}

\section{Background}

Following the retirement of the lead developer of MULTIFAN-CL (MFCL), Dave
Fournier, future advances to the MFCL software are not expected to be as
mathematically innovative as they were in the past. While this does not render
MFCL obsolete in the medium-term, it flags the need to plan and identify whether
alternative existing software exists, or new software must be developed in the
longer-term, to continue to support the specificities and future requirements of
WCPFC tuna stock assessments.

While MFCL (Fournier et al. 1998) continues to be improved to service the WCPFC
tuna assessment needs over at least the next 5+ years, it is important to start
on a phased approach to its replacement. An initial scoping phase is required to
assess what features and capabilities will be important in future assessment
software for tunas. This scoping phase will benefit from input from stock
assessment scientists across global tuna RFMOs. Once this scoping phase is
conducted, consideration of available software packages in relation to the
desired features and capabilities can be conducted. This may identify suitable
existing software that has potential to provide the desired features and/or has
potential to be developed further. Alternatively, it may indicate whether
embarking on development of a new software package is recommended.

There has also been discussion around the need to explore, through
modeling/simulation exercises, the benefits of applying alternative assessment
structures (i.e., length-age structured versus the traditional length-based
age-structured approach of MFCL and Stock Synthesis) before embarking on major
software developments or changing methodology. Similar can be said about
exploring benefits of state-space models and their use of random variables.
Simulation exercises to explore the benefits or drawbacks of alternative model
structures or approaches will also require collaboration across tuna RFMOs and
practitioners experienced in using the alternative approaches and/or software.

An important outcome of this work would be to ultimately have a software package
that has the desired functionality for tuna assessments, not only for WCPFC but
also for other tuna RFMOs, thus creating a user community and ongoing
development support capacity, so as to avoid the current situation we are facing
with MFCL. Wider collaboration in this venture is essential to achieving this
and is expected to be encouraged through this project.

\vspace{1ex}

\subsection{TOR summary}

The project terms of reference established at SC20 are listed in
\autoref{tab:tors}.

\newpage

\begin{table}
  \renewcommand\arraystretch{1.25}
  \centering
  \caption{Terms of reference established at SC20.\label{tab:tors}}
  \begin{tabular}{p{1cm}p{13cm}}
    \hline
    TOR & Description\\
    \hline
    1 & Review and identify a list of necessary features for software to do tuna
        stock assessments and identify existing software platforms that have
        these features or capacity to develop these.\\
    \hline
    2 & Conduct two workshops with selected experts from other tuna RFMOs and/or
        with relevant expertise. The first workshop can be remote (prior to
        SC20) and the second one potentially in person (post SC20). The main
        goal will be to communicate the scoping project, upcoming model
        explorations, and succession plans for MFCL and Stock Synthesis, to seek
        advice from the scientific community, and to seek collaboration with
        tRFMOs and various research labs.\\
    \hline
    3 & Explore the new RTMB programming environment and how it could be used in
        future tuna assessments. Specifically, how to modularize and organize
        code in RTMB models, on one hand code that is specific to one assessment
        and on the other hand code that is shared between assessments.\\
    \hline
    4 & Establish collaboration with NOAA scientists to explore the feasibility
        of enhancing the tagging module in Stock Synthesis, making it more
        similar to the tagging module in MFCL.\\
    \hline
    5 & Provide support to the stock assessment team transitioning the 2025
        swordfish assessment from MFCL to Stock Synthesis. Also, coordinate with
        the 2024/2025 striped marlin assessment team to start preparing for the
        transition of that assessment to Stock Synthesis in 2029.\\
    \hline
    6 & Compare a variety of software platforms using a simplified single-region
        WCPO yellowfin tuna dataset. The comparison will evaluate available
        features, run time speed, auxiliary tools, time and skills required to
        develop and diagnose models, and other characteristics.\\
    \hline
    7 & Prepare alternative workplans and budget scenarios for the larger
        implementing (main) project to go beyond scoping. The scoping project
        will be expected to transition into the main implementing project based
        on the discussions at SC21, budget considerations, and funding
        availability. It is expected that the work leading up SC21 will inform
        the implementing workplan options and budget estimations.\\
    \hline
    8 & Communicate with tuna RFMOs and other research labs to establish which
        RFMOs and labs are willing and able to commit scientist time to
        collaborate on specific tasks of the scoping project, as well as the
        upcoming main project.\\
    \hline
    9 & Communicate with tuna RFMOs and the FIMS project team to evaluate
        whether joint software development by tuna RFMOs could produce FIMS code
        modules, with the aim to develop future tuna assessment models using
        FIMS modules.\\
    \hline
  \end{tabular}
\end{table}

\clearpage

\section{Progress against TOR items}

This section describes the project activities in the last 12 months from August
2024 to August 2025, as they relate to terms of reference 1--9 that were
established at SC20.

\vspace{1ex}

\subsection{TOR work area 1 (2024 second half)}

\begin{quote}\sf
  Review and identify a list of necessary features for software to do tuna stock
  assessments and identify existing software platforms that have these features
  or capacity to develop these.
\end{quote}

\vspace{2ex}

A question was raised at SC20 about whether it would be possible to present a
review and evaluation of necessary software features and existing software. This
is provided below in one section covering software features and another section
covering existing software.

\subsubsection{Evaluation of necessary software features}

\vspace{1ex}

\textbf{Software features listed at CAPAM 2019 workshop}

\vspace{1ex}

The CAPAM 2019 Workshop on Next Generation Assessment Models produced a review
paper (Punt et al. 2020) that identifies a number of model features considered
important in future stock assessment software. The abstract of the review paper
lists these features:

\begin{itemize}
  \item Ability to to capture age and size dynamics simultaneously yet
  computationally efficiently, while also offering the option to run a model as
  purely age-structured for a simple and fast model
  \item Scale from data-rich to data-poor
  \item Include some multispecies capability
  \item More appropriately deal with temporal variation, e.g., random effects
  and state-space models
  \item Better handling of tagging data, e.g., release-conditioned or
  recapture-conditioned model
  \item Ability to use close-kin mark-recapture data
  \item Efficient methods to share parameter priors among stocks, borrowing
  information from similar stocks where more data have been collected
  \item Training programs and documentation
  \item Data entry system that is well documented
  \item Does not require specification of inputs that will not be used in an
  application
  \item Expert system to configure default settings based on best practices
  \item Automatic production of diagnostic statistics
\end{itemize}

\newpage

The summary table in Punt et al. (2020) adds the following features:

\begin{itemize}
  \item Spatial structure
  \item Multiple fisheries and surveys
  \item Flexible parametrization of the initial conditions
  \item Multiple time steps within a year
  \item Flexible parametrization of growth
  \item Flexible parametrization of natural mortality
  \item Flexible parametrization of fecundity
  \item Flexible parametrization of movement
  \item Multiple recruitment functional forms, including nonparametric
  \item Selectivity as a function of age, size, or both
  \item Multiple selectivity functional forms, including dome-shaped and
  asymptotic
  \item Incorporation of ageing error
  \item Ability to simulate datasets for management strategy evaluation
  \item Prefer statistically based likelihood weighting over subjective choices
  \item Ability to evaluate uncertainty using a variety of statistical methods
  \item Allow time-varying processes, both in biology and fishing processes
\end{itemize}

\vspace{2ex}

Further in the text, Punt et al. (2020) add the following features:

\begin{itemize}
  \item Allow for density-dependence at the spatial area level, as well as at
  the stock level
  \item Allow for nesting of spatial scales such that a population model can
  appropriately utilize data types collected at fine scale and coarse spatial
  resolutions
  \item Allow for multiple movement types including advection, diffusion, and
  that movement responds to environmental drivers
  \item Account for multiple hypotheses regarding movement, including age- and
  sex-specific processes processes, as well as density-dependent and
  time-varying movement
\end{itemize}

\newpage

\textbf{Software features listed at International Expert Meeting 2024}

At the launch of this scoping project in 2024, an international expert meeting
was held in two sessions. As a background for the meeting discussion, the
conveners (Magnusson and Davies 2024) highlighted model features that can be
especially relevant in tuna assessments:

\vspace{1ex}

\textit{Incorporating data}

\begin{itemize}
  \item Fit to length comps\\[-4.5ex]
  \item Fit to weight comps\\[-4.5ex]
  \item Fit to tagging data\\[-4.5ex]
  \item Fit to close-kin mark-recapture (CKMR) data\\[-4.5ex]
  \item Estimate growth curve using otolith data\\[-4.5ex]
  \item Utilize tag-recapture growth increment to estimate growth
\end{itemize}

\vspace{1ex}

\textit{Specifics}

\begin{itemize}
  \item Age-specific M\\[-4.5ex]
  \item Length-specific selectivity\\[-4.5ex]
  \item Sex-specific growth and M\\[-4.5ex]
  \item Region-specific growth
\end{itemize}

\vspace{1ex}

\textit{Dimensions}

\begin{itemize}
  \item Explicit regions with movement\\[-4.5ex]
  \item Tracking age and length in population\\[-4.5ex]
  \item Time steps within a year
\end{itemize}

\vspace{1ex}

\textit{Ecology}

\begin{itemize}
  \item Multispecies interactions\\[-4.5ex]
  \item Climate change
\end{itemize}

\vspace{1ex}

\textit{Implementation}

\begin{itemize}
  \item Random effects, state space\\[-4.5ex]
  \item Parallel computing\\[-4.5ex]
  \item Computation time
\end{itemize}

\newpage

\textbf{Software features: Conclusion}

As reflected in the software features identified at CAPAM 2019 and the
International Expert Meeting in 2024, there is a multitude of wish list options
for technical features in stock assessment software. No software will provide
all of these features, and the relative importance of individual features will
vary between stocks. For example:

\begin{itemize}
  \item The South Pacific albacore stock assessment will require the ability to
  incorporate close-kin mark-recapture (CKMR) data.
  \item The Western and Central Pacific Ocean (WCPO) skipjack stock assessment
  relies heavily on tagging data and should therefore employ the
  state-of-the-art statistical techniques for analyzing tagging data that are
  available at any time.
\end{itemize}

The best choice of a software for a given stock assessment will not only depend
on the precise features provided by each software, but also how well each
software allows the stock assessment team to work effectively to explore and
develop models to produce a high-quality assessment in the time frame between
the availability of data and the SC deadline for submitting the assessment
report.

The conclusion of this scoping project is that the critical softure requirements
for the WCPFC tuna and billfish assessments are best encapsulated in three
general criteria:

\begin{enumerate}
  \item \textit{Scientific quality}. The software should have good statistical
  performance, demonstrating a low level of estimation bias in self-test
  simulations. It should make good use of available data, incorporating all
  relevant information in a statistically sound manner. It should also allow
  spatial and temporal variability in processes relating to the biology and the
  fishery dynamics. The software should be computationally efficient and produce
  a fitted model within too many hours, thus allowing a full exploration of a
  variety of model options in the short stock assessment time frame. Finally,
  the software should support the provision of scientific advice that matches
  the needs for the management of each stock.
  \item \textit{Beginner friendly}. New staff scientists are often asked to
  start working with the stock assessment software within their first twelve
  months of contract. To make this feasible, the software user interface and
  auxiliary tools should allow new staff scientists to have a good understanding
  of the configuration of model options and be able to work efficiently with the
  model.
  \item \textit{Widely used}. SPC does not want to use stock assessment software
  in isolation. The software should have a large development team and user
  community beyond SPC. This will mean that new staff scientists can find expert
  help outside of SPC. Feature-complete tools for working with model input and
  output will be maintained outside of SPC. By adopting widely used stock
  assessment software, external reviewers will have a good understanding of
  model configurations and options.
\end{enumerate}

\vspace{1ex}

\subsubsection{Evaluation of existing software}

\textbf{Stock Synthesis}

\vspace{-1ex}

Stock Synthesis (SS3) is used in tuna assessments by the IATTC, IOTC, and ICCAT.
Compared to MFCL, SS3 has a less sophisticated statistical method to analyze
tagging data, which requires the scientist to convert length-at-release to
age-at-release outside the model. This is especially relevant for the WCPO
skipjack assessment. The SS3 development team does not plan to add new major
features such as the ability to incorporate CKMR data, which is especially
relevant for future South Pacific albacore assessment. On the other hand, the
increasing use of SS3 at SPC has had a marked positive impact on collaboration
between the tRFMOs, which is relevant for the discussion, development, and tests
of future software. The use of SS3 also shortens the training time for new SPC
stock assessors and makes their skills and experience more transferable between
workplaces. SS3 assessments allow closer comparisons of assessments conducted
across RFMOs and ISC. The large SS3 user community is relevant for seeking
expert insights, discussing technical model decisions, and for peer reviews. It
also comes with an exceptionally complete suite of tools useful for diagnostics,
as well as automated plots and tables for assessment reports.

Stock Synthesis scores particularly high in two key criteria: the ability of new
staff scientists to use it effectively and the worldwide user community,
including tuna RFMOs.

\vspace{1ex}

\textbf{Gadget}

\vspace{-1ex}

Gadget 3 is the latest version of Gadget stock assessment platform, implemented
in TMB. It is an age-length structured platform and the implementation of this
software in TMB has resulted in a significant performance gain in terms of
computational time, and opens the option of incorporating time-varying processes
using random effects. Gadget has a wide range of features relevant for tuna
assessments and a plan is underway to to test the use of Gadget on SPC example
tuna datasets.

Gadget scores particularly high for representing certain state-of-the art
statistical methods of interest: explicit age-length structure and a TMB
implementation that may allow the use of random effects to have processes vary
with time and/or between regions.

\vspace{1ex}

\textbf{SBT}

\vspace{-1ex}

The SBT software is used in the assessment of southern bluefin tuna by CCSBT.
The software is implemented as an R package based on RTMB and stands out as the
primary stock assessment software that is built around CKMR, a new and important
data type in future South Pacific albacore assessments. The SBT package is
designed for a single-region assessment and would require some additional
development to be used for a multiregion assessment. This scoping project has
reached out to the team of scientists inolved in the SBT assessment and will
discuss further the possibility of using their model code as a starting point
for developing new software for the South Pacific albacore assessment.

SBT scores particularly high for incorporating CKMR data in a tuna stock
assessment.

\vspace{1ex}

\textbf{FIMS}

\vspace{-1ex}

Fisheries Integrated Modeling System (FIMS) is a NOAA project that coordinates
the development of a next-generation framework of stock assessment models based
on TMB. The initial FIMS development and case studies have focused on models
fitting to age composition data, but the design includes the ability to fit to
length composition data. Spatially explicit models and tagging data are
currently not high priorities for the FIMS project. However, FIMS aims to
provide a modular and flexible design paradigm, allowing scientists to choose
and link together code modules to produce a stock assessment model that is
tailored for a particular assessment. For the purposes of tuna assessments, it
might be possible to design and develop specific code modules to link with the
FIMS core modules. Such tuna modules could potentially provide a variety of
features, adding basic model extensions and/or introducing underlying changes in
the model structure.

FIMS is at a relatively early stage of development, but it scores high for its
potential to become a mainstream stock assessment software. It seems likely that
many U.S. stock assessments using Stock Synthesis today will migrate to FIMS in
the future.

\vspace{1ex}

\textbf{Other}

\vspace{-1ex}

Casal 2 is the latest version of the Casal stock assessment platform, rewritten
with an improved design and user interface. Casal has a wide range of features
relevant for tuna assessments. However, its strengths and features fall slightly
short of Gadget 3 for the purposes of this scoping project.

\vspace{2ex}

\subsection{TOR work area 2 (2024 second half)}

\begin{quote}\sf
  Conduct two workshops with selected experts from other tuna RFMOs and/or with
  relevant expertise. The first workshop can be remote (prior to SC20) and the
  second one potentially in person (post SC20). The main goal will be to
  communicate the scoping project, upcoming model explorations, and succession
  plans for MFCL and Stock Synthesis, to seek advice from the scientific
  community, and to seek collaboration with tRFMOs and various research labs.
\end{quote}

\vspace{2ex}

Two workshops were conducted in 2024.

\vspace{2ex}

\textbf{Workshop 2024 I: International Expert Meeting 2024}

This remote workshop was held in two sessions on 13 May and 18 June 2024,
inviting stock assessment and software development experts from around the
world. Around 40 participants represented the tuna RFMOs (CCSBT, IATTC, ICCAT,
IOTC, WCPFC), stock assessment software projects (ALSCL, CASAL, FIMS, Gadget,
MFCL, SAM, sbt, Stock Synthesis, WHAM), and relevant programming environments
(ADMB, TMB, RTMB). The objectives, format, and outcomes from this workshop were
reviewed in the P123 progress report presented to SC20 in August 2024.

\newpage

\textbf{Workshop 2024 II: Project Strategy and Evaluation of Options}

\vspace{1ex}

This workshop was held 23--30 August 2024 in Matapouri, New Zealand, with two
in-person participants Arni Magnusson and Nick Davies, reaching out to Chris
Cahill and Lisa Chong (Michigan State University), and Jeremy McKenzie (NZ). The
following focus topics were covered in the workshop:

\begin{itemize}
  \item Needs and options for future SPC tuna and billfish assessments
  \item Multi-criteria decision making: scientific quality, beginner friendly,
  widely used
  \item FIMS could be the only option that can score high in all criteria
  \item Tuna RFMOs could collaborate and contribute tuna-specific modules to
  FIMS
  \item Age-length structure, possible simulation study to examine potential
  importance
  \item Gadget as the main platform using age-length structure
  \item RTMB is a new and efficient paradigm, but both FIMS and Gadget use TMB
  \item RTMB code design, modularity, maintenance, reusing code in different
  assessments
  \item Sparse matrix calculations, parallel computations
  \item MFCL tagging module, each release group becomes a parallel population
\end{itemize}

\vspace{1ex}

Conclusions from the Matapouri workshop served as a basis for evaluating the
necessary software features and existing software (TOR 1).

In particular, identifying the three general criteria for selecting stock
assessment software (scientific quality, beginner friendly, widely used) made it
clear that the choice of software is a case of multi-criteria decision making,
where it may not be possible to optimize all three criteria.

The workshop notes and report are available on the scoping project
\href{\tree/workshops/2024-08-matapouri}{website}, along with analytical scripts
and results.

\vspace{2ex}

\subsection{TOR work area 3 (2024 second half)}

\begin{quote}\sf
  Explore the new RTMB programming environment and how it could be used in
  future tuna assessments. Specifically, how to modularize and organize code in
  RTMB models, on one hand code that is specific to one assessment and on the
  other hand code that is shared between assessments.
\end{quote}

\vspace{2ex}

An initial evaluation of how RTMB code can be modularized and organized was
conducted as part of the 2024 Matapouri workshop, where scientists at Michigan
State University shared their recent reorganization of RTMB stock assessment
case studies.

\textit{Modular design}

The RTMB evaluation was resumed in December 2024, as part of a WCPO skipjack
growth study, converting TMB scripts to RTMB scripts. Growth curve estimation
using otoliths and tagging data is a simpler analysis than a full stock
assessment, but the workflow involves the same types of code:

\begin{enumerate}
  \item Model source code\\[-4.5ex]
  \item User code to prepare data in the model-specific format\\[-4.5ex]
  \item User code to specify model options\\[-4.5ex]
  \item User code to run model\\[-4.5ex]
  \item User code to read the results into tables\\[-2.5ex]
\end{enumerate}

In TMB, the separation is very clear, with the model source code written in a
\cpp\ file, while the user code is organized in one or more R scripts.

In RTMB, the separation can be less clear, since the model source code is
written in R. The example models that come with the RTMB package make a point of
interweaving the model source code with the user code in one monolithic script.
This is effective for demonstrating how much simpler the model source code is in
RTMB than in TMB, but for developing and maintaining larger models it is useful
to follow a modular design with a clear division between the general model
source code and the specific user application.

In the skipjack growth study, three tiers of modular organization were tested
and evaluated in RTMB. In the first tier, all code was interwoven in one script.
In the second tier, the model source code was saved in a separate R file and
then sourced into the user script. In the third tier, the model source code was
encapsulated in an R package that becomes a general method for any species, thus
completely separating the model from the specific skipjack growth study.

Developing a general model in RTMB requires a workaround in the form of a
special wrapper to pass a data object to the model. This subject was raised on
the RTMB discussion board in 2024 and resolved with a documented example added
to the package vignette later that same year.

\vspace{2ex}

\textit{CRAN package}

Having developed a general tool to estimate growth curves, it was decided to
share the \textsf{fishgrowth} package with the wider scientific community in
February 2025 by releasing it on CRAN (Magnusson and Maunder 2025). The package
allows scientists to fit growth curves to otoliths and/or tagging data, choosing
from five functional forms (von Bertalanffy, Richards, Gompertz, Schnute Case 3,
growth cessation), with each functional form offered using alternative
parametrizations.

\newpage

\textit{Linking packages}

As a follow-up to explore the ability to link RTMB packages, an additional
package \textsf{linear} was also implemented, adding one more functional form of
a growth model, different from the ones provided by the \textsf{fishgrowth}
package. In this experiment, we first add the \textsf{linear} package as a
dependency to the \textsf{fishgrowth} package and then create a new function
called \texttt{experiment()} inside \textsf{fishgrowth} that calls the
\textsf{linear} functional form. In short, the contributed growth curve was
fitted successfully and the integration between the two modules was seamless.

The outcome of this experiment was to demonstrate that it is trivially easy to
contribute additional functionality to an existing RTMB package. This experiment
is analogous to contributing a tuna-specific code module to link with FIMS core
packages, except FIMS is currently based on TMB rather than RTMB. The scoping
project is currently reaching out to collaborate with FIMS to explore the
technical procedures and programming interface involved in producing code
modules that can be linked with FIMS core modules. The expectation is that
contributing and linking code modules is more difficult in the FIMS/TMB paradigm
than in RTMB, but hopefully not much more difficult. See the proposed SPC-FIMS
workshop (\autoref{sec:fims-workshop}).

\vspace{2ex}

\textit{Comparison between TMB and RTMB}

Kasper Kristensen (DTU) released the TMB package on CRAN in 2015. It provides
the same automatic differentiation capability for parameter estimation as ADMB,
but with greatly improved functionality and performance when using random
effects. The developer writes the model source code in written in \cpp\, while
user scripts are written in R.

Kasper Kristensen released the RTMB package on CRAN in 2023. It uses the
underlying TMB engine to fit models, and the resulting model output and
computational speed is the same as in TMB. The main difference is that in RTMB,
the model source code is written in R, which has several important benefits. The
code becomes substantially shorter and easier to understand, modify, and debug.
There is no \cpp\ compilation lag while developing a model, and it is easy for
an RTMB package to provide many models rather than one. Linking code between
RTMB modules (packages and/or scripts) is also easier than in TMB.

When the scoping project reached out to the team of statisticians at DTU to
discuss the differences, they recommended writing all new modeling software in
RTMB rather than TMB, citing the benefits listed above. To strengthen the
longevity and usefulness of the SBT stock assessment model, it was ported from
ADMB to TMB and more recently to RTMB, which makes the software easier to
maintain and develop further. This does not mean that all current software
projects should be ported to RTMB, but for developing new software it is the
recommended programming environment.

\vspace{2ex}

\subsection{TOR work area 4 (2024 second half)}

\begin{quote}\sf
  Establish collaboration with NOAA scientists to explore the feasibility of
  enhancing the tagging module in Stock Synthesis, making it more similar to the
  tagging module in MFCL.
\end{quote}

\vspace{2ex}

To conduct this feasibility study, the scoping project reached out to Nicholas
Ducharme-Barth (NOAA PIFSC) and Mark Maunder (IATTC), while also studying the
MFCL code for analyzing tag releases and recaptures. The initial findings were
that the tagging `module' in MFCL is not an independent component that is easily
extracted from the code, but is meshed in the overall design of MFCL.

The way tagging data are handled in MFCL is that each release group produces a
parallel population, so when there are multiple tag releases year after year,
the model keeps track of a growing number of parallel populations. After a
certain number of years following a tag release, the release group enters a
pooled population of old releases, thus avoiding the need to track an
unnecessarily large number of parallel populations. More detailed commentary on
the tagging module in MFCL can be found in the
\href{\blob/workshops/2024-08-matapouri/notes/day1.md}{day1.md} notes from the
2024 Matapouri workshop.

The conclusion was that enhancing Stock Synthesis to apply the same statistical
method would be a major undertaking and will not be pursued as part of the
scoping project.

In discussions related to this TOR, Mark Maunder pointed out that IATTC has
recently had good success analyzing the tagging data externally, rather than
inside the stock assessment model, and recommended investigating this option for
WCPFC assessments that involve tagging data. See the resulting SPC-DTU workshop
(\autoref{sec:dtu-workshop}).

\vspace{2ex}

\subsection{TOR work area 5 (2025)}

\begin{quote}\sf
  Provide support to the stock assessment team transitioning the 2025 swordfish
  assessment from MFCL to Stock Synthesis. Also, coordinate with the 2024/2025
  striped marlin assessment team to start preparing for the transition of that
  assessment to Stock Synthesis in 2029.
\end{quote}

\vspace{1ex}

A decision at SC20 was to transition the Southwest Pacific swordfish assessment
to the Stock Synthesis software in 2025. In a January 2025, a joint SPC-NOAA
striped marlin stock assessment modeling workshop concluded that it would be
best to also transition the Southwest Pacific striped marlin assessment to the
Stock Synthesis software in 2025.

The support provided by members of the scoping project for these two billfish
assessments has been of the same nature as the teamwork behind all SPC stock
assessments. This has involved daily discussions and weekly meetings reviewing
the work in progress, providing code to configure multiple variations of the
model to run in parallel, analysis of an alternative growth curve from otolith
data, contributing to the report writing, etc.

The most valuable support for the two billfish assessments, however, came from
international colleagues. Mark Maunder and Nicholas Ducharme-Barth provided key
insights and improvements in the model configuration for these assessments.
Furthermore, when the stock assessors posted questions on the general Stock
Synthesis online forum, many scientists responded and shared their experiences,
ideas, and recommendations that have directly helped with these assessments.

Transitioning these assessments to Stock Synthesis has been a learning process
that requires new knowledge, tools, and technical solutions. The increased
interaction with the wider scientific community has already proved to be an
important benefit from using a widely used software platform for these
assessments.

\vspace{2ex}

\subsection{TOR work area 6 (2025)}

\begin{quote}\sf
  Compare a variety of software platforms using a simplified single-region WCPO
  yellowfin tuna dataset. The comparison will evaluate available features, run
  time speed, auxiliary tools, time and skills required to develop and diagnose
  models, and other characteristics.
\end{quote}

\vspace{2ex}

~

\vspace{2ex}

\subsection{TOR work area 7 (2025)}

\begin{quote}\sf
  Prepare alternative workplans and budget scenarios for the larger implementing
  (main) project to go beyond scoping. The scoping project will be expected to
  transition into the main implementing project based on the discussions at
  SC21, budget considerations, and funding availability. It is expected that the
  work leading up SC21 will inform the implementing workplan options and budget
  estimations.
\end{quote}

\vspace{2ex}

~

\vspace{2ex}

\subsection{TOR work area 8 (2025)}

\begin{quote}\sf
  Communicate with tuna RFMOs and other research labs to establish which RFMOs
  and labs are willing and able to commit scientist time to collaborate on
  specific tasks of the scoping project, as well as the upcoming main project.
\end{quote}

\vspace{2ex}

~

\vspace{2ex}

\subsection{TOR work area 9 (2025)}

\begin{quote}\sf
  Communicate with tuna RFMOs and the FIMS project team to evaluate whether
  joint software development by tuna RFMOs could produce FIMS code modules, with
  the aim to develop future tuna assessment models using FIMS modules.
\end{quote}

\vspace{2ex}

~

\vspace{2ex}

\section{Other recent project activitites}

\subsection{SPC-DTU workshop to analyze tagging data}
\label{sec:dtu-workshop}

Establish a collaborative research project, using a spatio-temporal model to
analyze tagging data outside the stock assessment model.

\section{Recommendation of project activities}

\subsection{SPC-FIMS workshop to explore linking modules}
\label{sec:fims-workshop}

Organize FIMS workshop to explore the technical procedures and programming
interface involved in producing FIMS modules.

\subsection{Support DTU analysis of WCPO skipjack tagging data}

\subsection{Develop Gadget model for single-area yellowfin dataset}

\subsection{Explore the possibility of using the SBT model code}

As a starting point for developing new software for the South Pacific albacore
assessment.

\subsection{Tuna RFMO workshop to review Stock Synthesis modeling techniques}

used in Stock Synthesis tuna assessment models

\subsection{Proposal for development of DTU spatio-temporal full assessment
  model}

\subsection{Proposal for development of tuna-specific FIMS modules}

\section{Updated project diagram}

\section{Note to SC}

\section{References}

\sloppy\setlength\hyphenpenalty{1000}

\begin{description}\setlength\itemsep{0ex}
  \item Fournier, D.A., J. Hampton, and J.R. Sibert. 1998. MULTIFAN-CL: A
  length-based, age-structured model for fisheries stock assessment, with
  application to South Pacific albacore, \textit{Thunnus alalunga}. Can. J.
  Fish. Aquat. Sci. 55:2105--2116.
  \item Magnusson, A. and M. Maunder. 2025. fishgrowth: Fit growth curves to
  fish data.\linebreak \href{https://doi.org/10.32614/CRAN.package.fishgrowth}
  {doi: 10.32614/CRAN.package.fishgrowth}
  \item Magnusson, A. and N. Davies. 2024b. Scoping the next stock assessment
  platform, stage I:\linebreak Reaching out to tuna RFMOs and the scientific
  community. Presented at the SPC international expert meeting, 13 May and 18
  June 2024. 31 pp.
  \href{\present/2024_05_13_experts_scoping/2024_05_13_experts_scoping.pdf}
  {Available online}.
  \item Punt, A.E., A. Dunn, B.Þ. Elvarsson, J. Hampton, S.D. Hoyle, M.N.
  Maunder, R.D. Methot, and A. Nielsen. 2020. Essential features of the
  next-generation integrated fisheries stock assessment package: A perspective.
  Fish. Res. 229:105617.
\end{description}

\end{document}
