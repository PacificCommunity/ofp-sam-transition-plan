\documentclass{SCreport}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{caption}
\usepackage{float}
\captionsetup{font=small}
\setcounter{tocdepth}{2}
\newcommand\github
{https://github.com/PacificCommunity/ofp-sam-transition-plan/blob/main}
\newcommand\h[1]{\hspace{#1}}
\newcommand\present{\github/presentations}
\newcommand\I[1]{\rule{0pt}{#1}}
\reporttype{SC21}
\reportauthor{A.~Magnusson\footnote{\spc}, N.~Davies\footnote{TeTakina Ltd},
  G.~Pilling$^1$, P.~Hamer$^1$}
\reporttitle{Scoping the Next Generation of Tuna Stock Assessment
  Software:\\Progress Report (Project 123)}
\reportnumber{\tpnum/SA-WP-01}
\reportdate{17 July 2025}
\setlength\hyphenpenalty{2000}
\setlength\tolerance{2000}
\hyphenation{}
\begin{document}

\wcpfctitlepage

\tableofcontents
\newpage

\section{Executive summary}

The 3-year Project 123 aims to evaluate features and capabilities that will be
important in future tuna assessments, explore fitting models to tuna data using
existing software platforms, guide decisions on the type of new software
development required, and establish collaboration with tuna Regional Fisheries
Management Organizations (RFMOs) and research labs to achieve these goals.

At SC20, ISG-09 reviewed the scoping of next-generation tuna stock assessment
software and supported prioritizing practical tasks, including transitioning
swordfish and striped marlin assessments to Stock Synthesis and testing
simplified models for yellowfin tuna. Members acknowledged the need to focus on
immediate assessment priorities while keeping longer-term software development
under consideration, depending on available resources and capacity. (SC20
Summary Report, Attachment E).

SC21 will review the progress of Project 123, which explores the transition to
next-generation stock assessment software for tuna fisheries. The project report
i) evaluates the benefits, limitations, uncertainties, and resource implications
associated with each software platform under consideration; ii) evaluates the
feasibility of analyzing tagging data independently from the main stock
assessment models, a potential strategy to reduce model complexity while
maintaining scientific robustness; and iii) identifies key analytical features
and technical capabilities that future stock assessment platforms should
incorporate, such as support for spatial structure, tagging integration, and
flexibility for multi-species and multi-fleet assessments, to ensure that WCPFC
assessments remain scientifically credible, transparent, and adaptable to
evolving fishery and management needs.

SC21 will provide feedback on the progress of the project as needed.

\vspace{4ex}

We invite SC21 to:

\begin{itemize}
  \item note that over the next 5+ years, MULTIFAN-CL will begin to be phased
  out as a software platform for WCPFC tuna and billfish stock assessments;
  \item note that in 2025, the two billfish stock assessments, swordfish and
  striped marlin, transitioned from MULTIFAN-CL to Stock Synthesis;
  \item review and comment on two suggested software development work streams,
  described in this report, providing feedback that will guide the preparation
  of project proposals to be presented to SC22; and
  \item convene an ISWG to discuss the progress and develop activities and a TOR
  for the third year of Project 123.
\end{itemize}

\section{Background}

Following the retirement of the lead developer of MULTIFAN-CL (MFCL), Dave
Fournier, future advances to the MFCL software are not expected to be as
mathematically innovative as they were in the past. While this does not render
MFCL obsolete in the medium-term, it flags the need to plan and identify whether
alternative existing software exists, or new software must be developed in the
longer-term, to continue to support the specificities and future requirements of
WCPFC tuna stock assessments.

While MFCL (Fournier et al. 1998) continues to be improved to service the WCPFC
tuna assessment needs over at least the next 5+ years, it is important to start
on a phased approach to its replacement. An initial scoping phase is required to
assess what features and capabilities will be important in future assessment
software for tunas. This scoping phase will benefit from input from stock
assessment scientists across global tuna RFMOs. Once this scoping phase is
conducted, consideration of available software packages in relation to the
desired features and capabilities can be conducted. This may identify suitable
existing software that has potential to provide the desired features and/or has
potential to be developed further. Alternatively, it may indicate whether
embarking on development of a new software package is recommended.

There has also been discussion around the need to explore, through
modeling/simulation exercises, the benefits of applying alternative assessment
structures (i.e., length-age structured versus the traditional length-based
age-structured approach of MFCL and Stock Synthesis) before embarking on major
software developments or changing methodology. Similar can be said about
exploring benefits of state-space models and their use of random variables.
Simulation exercises to explore the benefits or drawbacks of alternative model
structures or approaches will also require collaboration across tuna RFMOs and
practitioners experienced in using the alternative approaches and/or software.

An important outcome of this work would be to ultimately have a software package
that has the desired functionality for tuna assessments, not only for WCPFC but
also for other tuna RFMOs, thus creating a user community and ongoing
development support capacity, so as to avoid the current situation we are facing
with MFCL. Wider collaboration in this venture is essential to achieving this
and is expected to be encouraged through this project.

\section{Progress against TOR items}

\subsection{2024 (second half)}

Below are terms of reference that were established at SC20 to start working on
in the second half of 2024.

\subsubsection{TOR 1. Review and identify a list of necessary features for software to
  do tuna stock assessments and identify existing software platforms that have
  these features or capacity to develop these.}

\vspace{2ex}

\textbf{i. Review of necessary software features}

\vspace{2ex}

\textbf{CAPAM 2019}

\vspace{1ex}

The CAPAM 2019 Workshop on Next Generation Assessment Models produced a review
paper (Punt et al. 2020) that identifies a number of model features considered
important in future stock assessment software. The abstract of the review paper
lists these features:

\begin{itemize}
  \item Ability to to capture age and size dynamics simultaneously yet
  computationally efficiently, while also offering the option to run a model as
  purely age-structured for a simple and fast model
  \item Scale from data-rich to data-poor
  \item Include some multispecies capability
  \item More appropriately deal with temporal variation, e.g., random effects
  and state-space models
  \item Better handling of tagging data, e.g., release-conditioned or
  recapture-conditioned model
  \item Ability to use close-kin mark-recapture data
  \item Efficient methods to share parameter priors among stocks, borrowing
  information from similar stocks where more data have been collected
  \item Training programs and documentation
  \item Data entry system that is well documented
  \item Does not require specification of inputs that will not be used in an
  application
  \item Expert system to configure default settings based on best practices
  \item Automatic production of diagnostic statistics
\end{itemize}

\vspace{2ex}

The summary table in Punt et al. (2020) adds the following features:

\begin{itemize}
  \item Spatial structure
  \item Multiple fisheries and surveys
  \item Flexible parametrization of the initial conditions
  \item Multiple time steps within a year
  \item Flexible parametrization of growth
  \item Flexible parametrization of natural mortality
  \item Flexible parametrization of fecundity
  \item Flexible parametrization of movement
  \item Multiple recruitment functional forms, including nonparametric
  \item Selectivity as a function of age, size, or both
  \item Multiple selectivity functional forms, including dome-shaped and
  asymptotic
  \item Incorporation of ageing error
  \item Ability to simulate datasets for management strategy evaluation
  \item Prefer statistically based likelihood weighting over subjective choices
  \item Ability to evaluate uncertainty using a variety of statistical methods
  \item Allow time-varying processes, both in biology and fishing processes
\end{itemize}

\vspace{1.5ex}

Further in the text, Punt et al. (2020) add the following features:

\begin{itemize}
  \item Allow for density-dependence at the spatial area level, as well as at
  the stock level
  \item Allow for nesting of spatial scales such that a population model can
  appropriately utilize data types collected at fine scale and coarse spatial
  resolutions
  \item Allow for multiple movement types including advection, diffusion, and
  that movement responds to environmental drivers
  \item Account for multiple hypotheses regarding movement, including age- and
  sex-specific processes processes, as well as density-dependent and
  time-varying movement
\end{itemize}

\vspace{2ex}

\textbf{International Expert Meeting 2024}

At the launch of this scoping project in 2024, an international expert meeting
was held in two sessions. As a background for the meeting discussion, the
conveners (Magnusson and Davies 2024) highlighted model features that can be
especially relevant in tuna assessments:

\vspace{1ex}

\textit{Incorporating data}

\begin{itemize}
  \item Fit to length comps\\[-4.5ex]
  \item Fit to weight comps\\[-4.5ex]
  \item Fit to tagging data\\[-4.5ex]
  \item Fit to close-kin mark-recapture (CKMR) data\\[-4.5ex]
  \item Estimate growth curve using otolith data\\[-4.5ex]
  \item Utilize tag-recapture growth increment to estimate growth
\end{itemize}

\textit{Specifics}

\begin{itemize}
  \item Age-specific M\\[-4.5ex]
  \item Length-specific selectivity\\[-4.5ex]
  \item Sex-specific growth and M\\[-4.5ex]
  \item Region-specific growth
\end{itemize}

\vspace{1ex}

\textit{Dimensions}

\begin{itemize}
  \item Explicit regions with movement\\[-4.5ex]
  \item Tracking age and length in population\\[-4.5ex]
  \item Time steps within a year
\end{itemize}

\vspace{1ex}

\textit{Ecology}

\begin{itemize}
  \item Multispecies interactions\\[-4.5ex]
  \item Climate change
\end{itemize}

\vspace{1ex}

\textit{Implementation}

\begin{itemize}
  \item Random effects, state space\\[-4.5ex]
  \item Parallel computing\\[-4.5ex]
  \item Computation time
\end{itemize}

\vspace{3ex}

\textbf{Conclusion}

As reflected in the software features identified at CAPAM 2019 and the
International Expert Meeting in 2024, there is a multitude of wish list options
for technical features in stock assessment software. No software will provide
all of these features, and the relative importance of individual features will
vary between stocks. For example:

\begin{itemize}
  \item The South Pacific albacore stock assessment will require the ability to
  incorporate close-kin mark-recapture (CKMR) data.
  \item The Western and Central Pacific Ocean (WCPO) skipjack stock assessment
  relies heavily on tagging data and should therefore employ the
  state-of-the-art statistical techniques for analyzing tagging data that are
  available at any time.
\end{itemize}

The best choice of a software platform for a given stock assessment will not
only depend on the precise features provided by each software, but also how well
each software allows the stock assessment team to work effectively to explore
and develop models to produce a high-quality assessment in the time frame
between the availability of data and the SC deadline for submitting the
assessment report.

The conclusion of this scoping project is that the critical softure requirements
for the WCPFC tuna and billfish assessments are best encapsulated in three
general criteria:\\[-4ex]

\begin{enumerate}
  \item \textit{Scientific quality}. The software should have good statistical
  performance, demonstrating a low level of estimation bias in self-test
  simulations. It should make good use of available data, incorporating all
  relevant information in a statistically sound manner. It should also allow
  spatial and temporal variability in processes relating to the biology and the
  fishery dynamics. The software should be computationally efficient and produce
  a fitted model within too many hours, thus allowing a full exploration of a
  variety of model options in the short stock assessment time frame. Finally,
  the software should support the provision of scientific advice that matches
  the needs for the management of each stock.
  \item \textit{Beginner friendly}. New staff scientists are often asked to
  start working with the stock assessment software within their first twelve
  months of contract. To make this feasible, the software user interface and
  auxiliary tools should allow new staff scientists to have a good understanding
  of the configuration of model options and the ability to work efficiently with
  the model.
  \item \textit{Widely used}. SPC does not want to use stock assessment software
  in isolation. The software should have a large development team and user
  community beyond SPC. This will mean that new staff scientists can find expert
  help outside of SPC. Feature-complete tools for working with model input and
  output will be maintained outside of SPC. By adopting widely used stock
  assessment software, external reviewers will have a good understanding of
  model configurations and options.
\end{enumerate}

\vspace{1ex}

\textbf{ii. Review existing software}

\textbf{Stock Synthesis}

\vspace{-1ex}

Stock Synthesis (SS3) is used in tuna assessments by the IATTC, IOTC, and ICCAT.
Compared to MFCL, SS3 has a less sophisticated statistical method to analyze
tagging data, which is especially relevant for the WCPO skipjack assessment. The
SS3 development team does not plan to add new major features such as the ability
to incorporate CKMR data, which is especially relevant for future South Pacific
albacore assessment. On the other hand, the increasing use of SS3 at SPC has had
a marked positive impact on collaboration between the tRFMOs, which is relevant
for the discussion, development, and tests of future software. The use of SS3
also shortens the training time for new SPC stock assessors and makes their
skills and experience more transferable between workplaces. SS3 assessments
allow closer comparisons of assessments conducted across RFMOs and ISC. The
large SS3 user community is relevant for seeking expert insights, discussing
technical model decisions, and for peer reviews. It also comes with an
exceptionally complete suite of tools useful for diagnostics, as well as
automated plots and tables for assessment reports.

Stock Synthesis scores particularly high in two key criteria: the ability of new
staff scientists to use it effectively and the worldwide user community,
including tuna RFMOs.

\vspace{1ex}

\textbf{Gadget}

\vspace{-0.5ex}

Gadget 3 is the latest version of Gadget stock assessment platform, implemented
in TMB. It is an age-length structured platform and the implementation of this
software in TMB has resulted in a significant performance gain in terms of
computational time, and opens the option of incorporating time-varying processes
using random effects. Gadget has a wide range of features relevant for tuna
assessments and a plan is underway to to test the use of Gadget on SPC example
tuna datasets.

Gadget scores particularly high for representing certain state-of-the art
statistical methods of interest: explicit age-length structure and a TMB
implementation that may allow the use of random effects to have processes vary
with time and/or between regions.

\vspace{1ex}

\textbf{SBT}

\vspace{-0.5ex}

The SBT software is used in the assessment of southern bluefin tuna by CCSBT.
The software is implemented as an R package based on RTMB and stands out as the
primary stock assessment software that is built around CKMR, a new and important
data type in future South Pacific albacore assessments. The SBT package is
designed for a single-region assessment and would require some additional
development to be used for a multiregion assessment. This scoping project has
reached out to the team of scientists inolved in the SBT assessment and will
discuss further the possibility of using their model code as a starting point
for developing new software for the South Pacific albacore assessment.

SBT scores particularly high for incorporating CKMR data in a tuna stock
assessment.

\vspace{1ex}

\textbf{Other}

\vspace{-0.5ex}

Casal 2 is the latest version of the Casal stock assessment platform, rewritten
with an improved design and user interface. Casal has a wide range of features
that would be useful for tuna assessments. However, its strengths and features
fall slightly short of Gadget for the purposes of this scoping project.

\subsubsection{TOR 2. Conduct two workshops with selected experts from other
  tuna RFMOs and/or with relevant expertise. The first workshop can be remote
  (prior to SC20) and the second one potentially in person (post SC20). The main
  goal will be to communicate the scoping project, upcoming model explorations,
  and succession plans for MFCL and Stock Synthesis, to seek advice from the
  scientific community, and to seek collaboration with tRFMOs and various
  research labs.}

~

\subsubsection{TOR 3. Explore the new RTMB programming environment and how it
  could be used in future tuna assessments. Specifically, how to modularize and
  organize code in RTMB models, on one hand code that is specific to one
  assessment and on the other hand code that is shared between assessments.}

~

\subsubsection{TOR 4. Establish collaboration with NOAA scientists to explore
  the feasibility of enhancing the tagging module in Stock Synthesis, making it
  more similar to the tagging module in MFCL.}

~

\subsection{2025 (first half)}

\subsubsection{TOR 5. Provide support to the stock assessment team transitioning
  the 2025 swordfish assessment from MFCL to Stock Synthesis. Also, coordinate
  with the 2024/2025 striped marlin assessment team to start preparing for the
  transition of that assessment to Stock Synthesis in 2029.}

~

\subsubsection{TOR 6. Compare a variety of software platforms using a simplified
  single-region WCPO yellowfin tuna dataset. The comparison will evaluate
  available features, run time speed, auxiliary tools, time and skills required
  to develop and diagnose models, and other characteristics.}

~

\subsubsection{TOR 7. Prepare alternative workplans and budget scenarios for the
  larger implementing (main) project to go beyond scoping. The scoping project
  will be expected to transition into the main implementing project based on the
  discussions at SC21, budget considerations, and funding availability. It is
  expected that the work leading up SC21 will inform the implementing workplan
  options and budget estimations.}

~

\subsubsection{TOR 8. Communicate with tuna RFMOs and other research labs to
  establish which RFMOs and labs are willing and able to commit scientist time
  to collaborate on specific tasks of the scoping project, as well as the
  upcoming main project.}

~

\subsubsection{TOR 9. Communicate with tuna RFMOs and the FIMS project team to
  evaluate whether joint software development by tuna RFMOs could produce FIMS
  code modules, with the aim to develop future tuna assessment models using FIMS
  modules.}

\section{Recommendation of project activities}

\subsection{2025 (second half)}

FIMS workshop to explore the technical procedures and programming interface
involved in producing FIMS modules

Summarize tRFMO discussion

Support DTU analysis of WCPO skipjack tagging data

Develop Gadget model for single-area yellowfin dataset

Develop Stock Synthesis model for single-area yellowfin dataset

\subsection{2026 (first half)}

Prepare project proposal for development of DTU spatio-temporal full assessment
model

Prepare project proposal for development of tuna-specific FIMS modules

Prepare outline of simulation analysis that could be conducted to test the
importance of explicit age-length structure

Complete full scoping project report

\section{Updated project diagram}

\section{Note to SC}

\end{document}
